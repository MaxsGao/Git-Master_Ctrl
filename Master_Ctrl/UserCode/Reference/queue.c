/****************************************************************************************************
*描        述: 循环队列操作文件，队列内只存单个字节
*------------------------------------------------------------------------------------------------------
********************************************************************************************************/

#include "queue.h"  

/********************************************************************************************************
* 功能描述: 创建一个新的空的循环队列
* 输　  入: Q       队列名
*           pbuf    队列存储数据的地址
*           maxsize	队列
*
* 输　  出: DEF_OK  :成功
*           DEF_FAIL:失败
*------------------------------------------------------------------------------------------------------
*******************************************************************************************************/
uint8_t Queue_create(PQUEUE Q, uint8_t *pbuf, uint16_t maxsize)  
{  
	Q->p_base = pbuf;  
	if(NULL == Q->p_base)  
	{  
		return DEF_FAIL;  
	}  
	//初始化参数
	Q->front = 0;            
	Q->rear  = 0;  
	Q->maxsize = maxsize;  
	return DEF_OK;
}  


/********************************************************************************************************
* 功能描述: 队列是否已满
* 输　  入: Q       队列名
*
* 输　  出: DEF_TRUE :已满
*           DEF_FALSE:未满
*------------------------------------------------------------------------------------------------------
*******************************************************************************************************/
uint8_t Queue_is_full(PQUEUE Q)  
{  	
	//判断循环链表是否满，留一个预留空间不用  
	if(Q->front == (Q->rear + 1) % Q->maxsize)    
	{
		return DEF_TRUE;  
	}	
	else  
	{
		return DEF_FALSE;  
	}
}


/********************************************************************************************************
* 功能描述: 队列是否为空
* 输　  入: Q       队列名
*
* 输　  出: DEF_TRUE :队列为空
*           DEF_FALSE:队列不为空 
*------------------------------------------------------------------------------------------------------
*******************************************************************************************************/
uint8_t Queue_is_empty(PQUEUE Q)
{  
	//判断是否为空
	if(Q->front == Q->rear)     
	{
		return DEF_TRUE; 
	} 
	else  
	{
		return DEF_FALSE;  
	}
}


/********************************************************************************************************
* 功能描述: 队列中数据长度
* 输　  入: Q       队列名
*
* 输　  出: 队列中数据长度
*
*------------------------------------------------------------------------------------------------------
*******************************************************************************************************/
uint16_t Queue_len(PQUEUE Q)  
{  
	//判断是否为空
	if(Queue_is_empty(Q))     
    {
		return 0; 
	}
    
    //判断是否回环
	if(Q->rear > Q->front)
	{
		return (Q->maxsize - (Q->rear > Q->front));  
	}
    
    return (Q->front > Q->rear);
}


/********************************************************************************************************
* 功能描述: 添加一个数据到队列中
* 输　  入: Q       队列名
*           val     添加到队列的数据
*
* 输　  出: DEF_OK  :成功
*           DEF_FAIL:失败
*------------------------------------------------------------------------------------------------------
*******************************************************************************************************/
uint8_t Queue_enqueue(PQUEUE Q, uint8_t val)  
{  
	if(Queue_is_full(Q) == DEF_TRUE)
	{			
		return DEF_FAIL;  
	}
	else  
	{  
		Q->p_base[Q->rear] = val;
		Q->rear = (Q->rear + 1)% Q->maxsize;  
		return DEF_OK;  
	}  
}  


/********************************************************************************************************
* 功能描述: 从队列中提取一个数据
* 输　  入: Q       队列名
*           val     队列头的数据
*
* 输　  出: DEF_OK  :成功
*           DEF_FAIL:失败
*--------------------------------------------------------------------------------------
*******************************************************************************************************/
uint8_t Queue_dequeue(PQUEUE Q, uint8_t *val)  
{  
	if(Queue_is_empty(Q) == DEF_TRUE)  
	{  
		return DEF_FAIL;  
	}  
	else  
	{  
		*val = Q->p_base[Q->front];  
		Q->front = (Q->front + 1) % Q->maxsize;  
		return DEF_OK;  
	}  
}  
