/*
*********************************************************************************************************
*
*
*                                  User program main function
*                                        用户程序主函数
* File : user_main.c
* By   : MaxsGao
* Date : 
* version :  
* NOTE(s) : 
* History : 
*
*
*********************************************************************************************************
*/


/*
*********************************************************************************************************
*                                       INCLUDES            头文件
*********************************************************************************************************
*/
#include "user_main.h"


/*
*********************************************************************************************************
*                                       CONSTANTS           常量
*********************************************************************************************************
*/


/*
*********************************************************************************************************
*                                       VARIABLES           变量
*********************************************************************************************************
*/
static OS_STK START_TASK_STK[START_STK_SIZE];   //任务堆栈变量


/*
*********************************************************************************************************
*                                       LOCAL FUNCTIONS     静态函数
*********************************************************************************************************
*/
/**@brief   开始任务函数
	*@param   None
	*@ret     None
	*/
static void start_task(void)            //START 任务
{
	OS_CPU_SR cpu_sr=0;
    
	OSStatInit();                       //开启统计任务
    
	OS_ENTER_CRITICAL();                //进入临界区(关闭中断)
    
    User_TaskCreate();                  //用户任务创建函数
    
	OSTaskSuspend(START_TASK_PRIO);     //挂起开始任务
	OS_EXIT_CRITICAL();                 //退出临界区(开中断)
}


/*
*********************************************************************************************************
*                                       API FUNCTIONS       API接口函数
*********************************************************************************************************
*/
/*
*********************************************************************************************************
*                                        main()
*
* Description : Program main function.  程序主函数
*
* Parameters  : void
*
* Return      : int
*
*Note(s):
*********************************************************************************************************
*/
int main(void)
{
	BSP_Init();     //硬件平台初始化
    
	OSInit();       //uC/OS-II初始化
    
    /* 创建开始任务 */
//	OSTaskCreate(
//		(void (*)(void *)) start_task,
//		(void          * ) 0,
//		(OS_STK        * ) &START_TASK_STK[START_STK_SIZE-1],
//		(INT8U           ) START_TASK_PRIO );
    OSTaskCreateExt(
        (void (*)(void *)) start_task,
        (void          * ) 0,
        (OS_STK        * ) &START_TASK_STK[START_STK_SIZE-1],
        (INT8U           ) START_TASK_PRIO,
        (INT8U           ) START_TASK_PRIO,
        (OS_STK        * ) &START_TASK_STK[0],
        (INT32U          ) START_STK_SIZE,
        (void          * ) 0,
        OS_TASK_OPT_STK_CHK | OS_TASK_OPT_STK_CLR);
    
	OSStart();      //系统启动
}

